{"{\"assumptions\":{},\"sourceRoot\":\"A:\\\\Blockchainformedia\\\\test\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"A:\\\\Blockchainformedia\",\"filename\":\"A:\\\\Blockchainformedia\\\\test\\\\Payment.test.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"A:\\\\Blockchainformedia\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.25.2:development":{"value":{"code":"const {\n  expect\n} = require(\"chai\");\nconst Payment = artifacts.require(\"Payment\");\nconst AccessControl = artifacts.require(\"AccessControl\");\nconst ERC20 = artifacts.require(\"ERC20\"); // Assuming you have an ERC20 token contract for testing\n\ncontract(\"Payment\", accounts => {\n  let payment;\n  let paymentToken;\n  const [owner, admin, creator, user] = accounts;\n  beforeEach(async () => {\n    // Deploy an ERC20 token for payment\n    paymentToken = await ERC20.new(\"TestToken\", \"TT\", 1000000, {\n      from: owner\n    });\n\n    // Deploy the AccessControl contract\n    const accessControl = await AccessControl.new();\n    await accessControl.addAdmin(admin, {\n      from: owner\n    });\n\n    // Deploy the Payment contract\n    payment = await Payment.new(paymentToken.address, 5, owner); // 5% platform fee\n\n    // Mint some tokens to the user for testing\n    await paymentToken.transfer(user, 1000, {\n      from: owner\n    });\n  });\n  describe(\"Payment Processing\", () => {\n    it(\"should allow users to process a payment\", async () => {\n      const amount = 100;\n      await paymentToken.approve(payment.address, amount, {\n        from: user\n      });\n      const userBalanceBefore = await paymentToken.balanceOf(user);\n      const creatorBalanceBefore = await paymentToken.balanceOf(creator);\n      const platformBalanceBefore = await paymentToken.balanceOf(owner);\n      await payment.processPayment(user, creator, amount, {\n        from: admin\n      });\n      const userBalanceAfter = await paymentToken.balanceOf(user);\n      const creatorBalanceAfter = await paymentToken.balanceOf(creator);\n      const platformBalanceAfter = await paymentToken.balanceOf(owner);\n      expect(userBalanceAfter.toString()).to.equal(userBalanceBefore.sub(amount).toString());\n      expect(creatorBalanceAfter.toString()).to.equal(creatorBalanceBefore.add(amount * 0.95).toString()); // 95% to creator\n      expect(platformBalanceAfter.toString()).to.equal(platformBalanceBefore.add(amount * 0.05).toString()); // 5% to platform\n    });\n    it(\"should revert if the payment amount is zero\", async () => {\n      await expect(payment.processPayment(user, creator, 0, {\n        from: admin\n      })).to.be.revertedWith(\"Payment amount must be greater than zero\");\n    });\n    it(\"should revert if the buyer has insufficient allowance\", async () => {\n      const amount = 100;\n      await expect(payment.processPayment(user, creator, amount, {\n        from: admin\n      })).to.be.revertedWith(\"Platform fee transfer failed\");\n    });\n  });\n  describe(\"Platform Fee Management\", () => {\n    it(\"should allow the admin to update the platform fee\", async () => {\n      await payment.updatePlatformFee(10, {\n        from: admin\n      });\n      const newFee = await payment.platformFee();\n      expect(newFee.toString()).to.equal(\"10\");\n    });\n    it(\"should emit an event when the platform fee is updated\", async () => {\n      const oldFee = await payment.platformFee();\n      const tx = await payment.updatePlatformFee(10, {\n        from: admin\n      });\n      const newFee = await payment.platformFee();\n      expect(tx.logs[0].event).to.equal(\"PlatformFeeUpdated\");\n      expect(tx.logs[0].args.oldFee.toString()).to.equal(oldFee.toString());\n      expect(tx.logs[0].args.newFee.toString()).to.equal(\"10\");\n    });\n    it(\"should not allow non-admin to update the platform fee\", async () => {\n      await expect(payment.updatePlatformFee(10, {\n        from: creator\n      })).to.be.revertedWith(\"Only the admin can perform this action\");\n    });\n    it(\"should not allow invalid platform fee updates\", async () => {\n      await expect(payment.updatePlatformFee(101, {\n        from: admin\n      })).to.be.revertedWith(\"Invalid fee percentage\");\n    });\n  });\n  describe(\"Platform Wallet Management\", () => {\n    it(\"should allow the admin to update the platform wallet\", async () => {\n      const newWallet = accounts[2];\n      await payment.updatePlatformWallet(newWallet, {\n        from: admin\n      });\n      const updatedWallet = await payment.platformWallet();\n      expect(updatedWallet).to.equal(newWallet);\n    });\n    it(\"should emit an event when the platform wallet is updated\", async () => {\n      const oldWallet = await payment.platformWallet();\n      const newWallet = accounts[2];\n      const tx = await payment.updatePlatformWallet(newWallet, {\n        from: admin\n      });\n      expect(tx.logs[0].event).to.equal(\"PlatformWalletUpdated\");\n      expect(tx.logs[0].args.oldWallet).to.equal(oldWallet);\n      expect(tx.logs[0].args.newWallet).to.equal(newWallet);\n    });\n    it(\"should not allow non-admin to update the platform wallet\", async () => {\n      await expect(payment.updatePlatformWallet(accounts[2], {\n        from: creator\n      })).to.be.revertedWith(\"Only the admin can perform this action\");\n    });\n    it(\"should not allow setting the platform wallet to the zero address\", async () => {\n      await expect(payment.updatePlatformWallet(\"0x0000000000000000000000000000000000000000\", {\n        from: admin\n      })).to.be.revertedWith(\"New wallet address cannot be zero address\");\n    });\n  });\n  describe(\"Withdraw Tokens\", () => {\n    it(\"should allow the owner to withdraw mistakenly sent tokens\", async () => {\n      await paymentToken.transfer(payment.address, 100, {\n        from: owner\n      });\n      const balanceBefore = await paymentToken.balanceOf(owner);\n      await payment.withdrawTokens(paymentToken.address, owner, 50, {\n        from: owner\n      });\n      const balanceAfter = await paymentToken.balanceOf(owner);\n      expect(balanceAfter.toString()).to.equal(balanceBefore.add(50).toString());\n    });\n    it(\"should revert if trying to withdraw more than the contract balance\", async () => {\n      await paymentToken.transfer(payment.address, 100, {\n        from: owner\n      });\n      await expect(payment.withdrawTokens(paymentToken.address, owner, 200, {\n        from: owner\n      })).to.be.revertedWith(\"Insufficient token balance\");\n    });\n    it(\"should not allow non-owner to withdraw tokens\", async () => {\n      await expect(payment.withdrawTokens(paymentToken.address, owner, 50, {\n        from: admin\n      })).to.be.revertedWith(\"Ownable: caller is not the owner\");\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBlY3QiLCJyZXF1aXJlIiwiUGF5bWVudCIsImFydGlmYWN0cyIsIkFjY2Vzc0NvbnRyb2wiLCJFUkMyMCIsImNvbnRyYWN0IiwiYWNjb3VudHMiLCJwYXltZW50IiwicGF5bWVudFRva2VuIiwib3duZXIiLCJhZG1pbiIsImNyZWF0b3IiLCJ1c2VyIiwiYmVmb3JlRWFjaCIsIm5ldyIsImZyb20iLCJhY2Nlc3NDb250cm9sIiwiYWRkQWRtaW4iLCJhZGRyZXNzIiwidHJhbnNmZXIiLCJkZXNjcmliZSIsIml0IiwiYW1vdW50IiwiYXBwcm92ZSIsInVzZXJCYWxhbmNlQmVmb3JlIiwiYmFsYW5jZU9mIiwiY3JlYXRvckJhbGFuY2VCZWZvcmUiLCJwbGF0Zm9ybUJhbGFuY2VCZWZvcmUiLCJwcm9jZXNzUGF5bWVudCIsInVzZXJCYWxhbmNlQWZ0ZXIiLCJjcmVhdG9yQmFsYW5jZUFmdGVyIiwicGxhdGZvcm1CYWxhbmNlQWZ0ZXIiLCJ0b1N0cmluZyIsInRvIiwiZXF1YWwiLCJzdWIiLCJhZGQiLCJiZSIsInJldmVydGVkV2l0aCIsInVwZGF0ZVBsYXRmb3JtRmVlIiwibmV3RmVlIiwicGxhdGZvcm1GZWUiLCJvbGRGZWUiLCJ0eCIsImxvZ3MiLCJldmVudCIsImFyZ3MiLCJuZXdXYWxsZXQiLCJ1cGRhdGVQbGF0Zm9ybVdhbGxldCIsInVwZGF0ZWRXYWxsZXQiLCJwbGF0Zm9ybVdhbGxldCIsIm9sZFdhbGxldCIsImJhbGFuY2VCZWZvcmUiLCJ3aXRoZHJhd1Rva2VucyIsImJhbGFuY2VBZnRlciJdLCJzb3VyY2VSb290IjoiQTpcXEJsb2NrY2hhaW5mb3JtZWRpYVxcdGVzdFxcIiwic291cmNlcyI6WyJQYXltZW50LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBQYXltZW50ID0gYXJ0aWZhY3RzLnJlcXVpcmUoXCJQYXltZW50XCIpO1xyXG5jb25zdCBBY2Nlc3NDb250cm9sID0gYXJ0aWZhY3RzLnJlcXVpcmUoXCJBY2Nlc3NDb250cm9sXCIpO1xyXG5jb25zdCBFUkMyMCA9IGFydGlmYWN0cy5yZXF1aXJlKFwiRVJDMjBcIik7IC8vIEFzc3VtaW5nIHlvdSBoYXZlIGFuIEVSQzIwIHRva2VuIGNvbnRyYWN0IGZvciB0ZXN0aW5nXHJcblxyXG5jb250cmFjdChcIlBheW1lbnRcIiwgKGFjY291bnRzKSA9PiB7XHJcbiAgICBsZXQgcGF5bWVudDtcclxuICAgIGxldCBwYXltZW50VG9rZW47XHJcbiAgICBjb25zdCBbb3duZXIsIGFkbWluLCBjcmVhdG9yLCB1c2VyXSA9IGFjY291bnRzO1xyXG5cclxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIC8vIERlcGxveSBhbiBFUkMyMCB0b2tlbiBmb3IgcGF5bWVudFxyXG4gICAgICAgIHBheW1lbnRUb2tlbiA9IGF3YWl0IEVSQzIwLm5ldyhcIlRlc3RUb2tlblwiLCBcIlRUXCIsIDEwMDAwMDAsIHsgZnJvbTogb3duZXIgfSk7XHJcblxyXG4gICAgICAgIC8vIERlcGxveSB0aGUgQWNjZXNzQ29udHJvbCBjb250cmFjdFxyXG4gICAgICAgIGNvbnN0IGFjY2Vzc0NvbnRyb2wgPSBhd2FpdCBBY2Nlc3NDb250cm9sLm5ldygpO1xyXG4gICAgICAgIGF3YWl0IGFjY2Vzc0NvbnRyb2wuYWRkQWRtaW4oYWRtaW4sIHsgZnJvbTogb3duZXIgfSk7XHJcblxyXG4gICAgICAgIC8vIERlcGxveSB0aGUgUGF5bWVudCBjb250cmFjdFxyXG4gICAgICAgIHBheW1lbnQgPSBhd2FpdCBQYXltZW50Lm5ldyhwYXltZW50VG9rZW4uYWRkcmVzcywgNSwgb3duZXIpOyAvLyA1JSBwbGF0Zm9ybSBmZWVcclxuXHJcbiAgICAgICAgLy8gTWludCBzb21lIHRva2VucyB0byB0aGUgdXNlciBmb3IgdGVzdGluZ1xyXG4gICAgICAgIGF3YWl0IHBheW1lbnRUb2tlbi50cmFuc2Zlcih1c2VyLCAxMDAwLCB7IGZyb206IG93bmVyIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJQYXltZW50IFByb2Nlc3NpbmdcIiwgKCkgPT4ge1xyXG4gICAgICAgIGl0KFwic2hvdWxkIGFsbG93IHVzZXJzIHRvIHByb2Nlc3MgYSBwYXltZW50XCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gMTAwO1xyXG4gICAgICAgICAgICBhd2FpdCBwYXltZW50VG9rZW4uYXBwcm92ZShwYXltZW50LmFkZHJlc3MsIGFtb3VudCwgeyBmcm9tOiB1c2VyIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdXNlckJhbGFuY2VCZWZvcmUgPSBhd2FpdCBwYXltZW50VG9rZW4uYmFsYW5jZU9mKHVzZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBjcmVhdG9yQmFsYW5jZUJlZm9yZSA9IGF3YWl0IHBheW1lbnRUb2tlbi5iYWxhbmNlT2YoY3JlYXRvcik7XHJcbiAgICAgICAgICAgIGNvbnN0IHBsYXRmb3JtQmFsYW5jZUJlZm9yZSA9IGF3YWl0IHBheW1lbnRUb2tlbi5iYWxhbmNlT2Yob3duZXIpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgcGF5bWVudC5wcm9jZXNzUGF5bWVudCh1c2VyLCBjcmVhdG9yLCBhbW91bnQsIHsgZnJvbTogYWRtaW4gfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB1c2VyQmFsYW5jZUFmdGVyID0gYXdhaXQgcGF5bWVudFRva2VuLmJhbGFuY2VPZih1c2VyKTtcclxuICAgICAgICAgICAgY29uc3QgY3JlYXRvckJhbGFuY2VBZnRlciA9IGF3YWl0IHBheW1lbnRUb2tlbi5iYWxhbmNlT2YoY3JlYXRvcik7XHJcbiAgICAgICAgICAgIGNvbnN0IHBsYXRmb3JtQmFsYW5jZUFmdGVyID0gYXdhaXQgcGF5bWVudFRva2VuLmJhbGFuY2VPZihvd25lcik7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QodXNlckJhbGFuY2VBZnRlci50b1N0cmluZygpKS50by5lcXVhbCh1c2VyQmFsYW5jZUJlZm9yZS5zdWIoYW1vdW50KS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNyZWF0b3JCYWxhbmNlQWZ0ZXIudG9TdHJpbmcoKSkudG8uZXF1YWwoY3JlYXRvckJhbGFuY2VCZWZvcmUuYWRkKGFtb3VudCAqIDAuOTUpLnRvU3RyaW5nKCkpOyAvLyA5NSUgdG8gY3JlYXRvclxyXG4gICAgICAgICAgICBleHBlY3QocGxhdGZvcm1CYWxhbmNlQWZ0ZXIudG9TdHJpbmcoKSkudG8uZXF1YWwocGxhdGZvcm1CYWxhbmNlQmVmb3JlLmFkZChhbW91bnQgKiAwLjA1KS50b1N0cmluZygpKTsgLy8gNSUgdG8gcGxhdGZvcm1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJzaG91bGQgcmV2ZXJ0IGlmIHRoZSBwYXltZW50IGFtb3VudCBpcyB6ZXJvXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KHBheW1lbnQucHJvY2Vzc1BheW1lbnQodXNlciwgY3JlYXRvciwgMCwgeyBmcm9tOiBhZG1pbiB9KSkudG8uYmUucmV2ZXJ0ZWRXaXRoKFwiUGF5bWVudCBhbW91bnQgbXVzdCBiZSBncmVhdGVyIHRoYW4gemVyb1wiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJzaG91bGQgcmV2ZXJ0IGlmIHRoZSBidXllciBoYXMgaW5zdWZmaWNpZW50IGFsbG93YW5jZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9IDEwMDtcclxuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KHBheW1lbnQucHJvY2Vzc1BheW1lbnQodXNlciwgY3JlYXRvciwgYW1vdW50LCB7IGZyb206IGFkbWluIH0pKS50by5iZS5yZXZlcnRlZFdpdGgoXCJQbGF0Zm9ybSBmZWUgdHJhbnNmZXIgZmFpbGVkXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJQbGF0Zm9ybSBGZWUgTWFuYWdlbWVudFwiLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoXCJzaG91bGQgYWxsb3cgdGhlIGFkbWluIHRvIHVwZGF0ZSB0aGUgcGxhdGZvcm0gZmVlXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgcGF5bWVudC51cGRhdGVQbGF0Zm9ybUZlZSgxMCwgeyBmcm9tOiBhZG1pbiB9KTtcclxuICAgICAgICAgICAgY29uc3QgbmV3RmVlID0gYXdhaXQgcGF5bWVudC5wbGF0Zm9ybUZlZSgpO1xyXG4gICAgICAgICAgICBleHBlY3QobmV3RmVlLnRvU3RyaW5nKCkpLnRvLmVxdWFsKFwiMTBcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KFwic2hvdWxkIGVtaXQgYW4gZXZlbnQgd2hlbiB0aGUgcGxhdGZvcm0gZmVlIGlzIHVwZGF0ZWRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvbGRGZWUgPSBhd2FpdCBwYXltZW50LnBsYXRmb3JtRmVlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gYXdhaXQgcGF5bWVudC51cGRhdGVQbGF0Zm9ybUZlZSgxMCwgeyBmcm9tOiBhZG1pbiB9KTtcclxuICAgICAgICAgICAgY29uc3QgbmV3RmVlID0gYXdhaXQgcGF5bWVudC5wbGF0Zm9ybUZlZSgpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHR4LmxvZ3NbMF0uZXZlbnQpLnRvLmVxdWFsKFwiUGxhdGZvcm1GZWVVcGRhdGVkXCIpO1xyXG4gICAgICAgICAgICBleHBlY3QodHgubG9nc1swXS5hcmdzLm9sZEZlZS50b1N0cmluZygpKS50by5lcXVhbChvbGRGZWUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0eC5sb2dzWzBdLmFyZ3MubmV3RmVlLnRvU3RyaW5nKCkpLnRvLmVxdWFsKFwiMTBcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KFwic2hvdWxkIG5vdCBhbGxvdyBub24tYWRtaW4gdG8gdXBkYXRlIHRoZSBwbGF0Zm9ybSBmZWVcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocGF5bWVudC51cGRhdGVQbGF0Zm9ybUZlZSgxMCwgeyBmcm9tOiBjcmVhdG9yIH0pKS50by5iZS5yZXZlcnRlZFdpdGgoXCJPbmx5IHRoZSBhZG1pbiBjYW4gcGVyZm9ybSB0aGlzIGFjdGlvblwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJzaG91bGQgbm90IGFsbG93IGludmFsaWQgcGxhdGZvcm0gZmVlIHVwZGF0ZXNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocGF5bWVudC51cGRhdGVQbGF0Zm9ybUZlZSgxMDEsIHsgZnJvbTogYWRtaW4gfSkpLnRvLmJlLnJldmVydGVkV2l0aChcIkludmFsaWQgZmVlIHBlcmNlbnRhZ2VcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZShcIlBsYXRmb3JtIFdhbGxldCBNYW5hZ2VtZW50XCIsICgpID0+IHtcclxuICAgICAgICBpdChcInNob3VsZCBhbGxvdyB0aGUgYWRtaW4gdG8gdXBkYXRlIHRoZSBwbGF0Zm9ybSB3YWxsZXRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuZXdXYWxsZXQgPSBhY2NvdW50c1syXTtcclxuICAgICAgICAgICAgYXdhaXQgcGF5bWVudC51cGRhdGVQbGF0Zm9ybVdhbGxldChuZXdXYWxsZXQsIHsgZnJvbTogYWRtaW4gfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRXYWxsZXQgPSBhd2FpdCBwYXltZW50LnBsYXRmb3JtV2FsbGV0KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVkV2FsbGV0KS50by5lcXVhbChuZXdXYWxsZXQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdChcInNob3VsZCBlbWl0IGFuIGV2ZW50IHdoZW4gdGhlIHBsYXRmb3JtIHdhbGxldCBpcyB1cGRhdGVkXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgb2xkV2FsbGV0ID0gYXdhaXQgcGF5bWVudC5wbGF0Zm9ybVdhbGxldCgpO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdXYWxsZXQgPSBhY2NvdW50c1syXTtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBhd2FpdCBwYXltZW50LnVwZGF0ZVBsYXRmb3JtV2FsbGV0KG5ld1dhbGxldCwgeyBmcm9tOiBhZG1pbiB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdCh0eC5sb2dzWzBdLmV2ZW50KS50by5lcXVhbChcIlBsYXRmb3JtV2FsbGV0VXBkYXRlZFwiKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR4LmxvZ3NbMF0uYXJncy5vbGRXYWxsZXQpLnRvLmVxdWFsKG9sZFdhbGxldCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0eC5sb2dzWzBdLmFyZ3MubmV3V2FsbGV0KS50by5lcXVhbChuZXdXYWxsZXQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdChcInNob3VsZCBub3QgYWxsb3cgbm9uLWFkbWluIHRvIHVwZGF0ZSB0aGUgcGxhdGZvcm0gd2FsbGV0XCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KHBheW1lbnQudXBkYXRlUGxhdGZvcm1XYWxsZXQoYWNjb3VudHNbMl0sIHsgZnJvbTogY3JlYXRvciB9KSkudG8uYmUucmV2ZXJ0ZWRXaXRoKFwiT25seSB0aGUgYWRtaW4gY2FuIHBlcmZvcm0gdGhpcyBhY3Rpb25cIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KFwic2hvdWxkIG5vdCBhbGxvdyBzZXR0aW5nIHRoZSBwbGF0Zm9ybSB3YWxsZXQgdG8gdGhlIHplcm8gYWRkcmVzc1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChwYXltZW50LnVwZGF0ZVBsYXRmb3JtV2FsbGV0KFwiMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwXCIsIHsgZnJvbTogYWRtaW4gfSkpLnRvLmJlLnJldmVydGVkV2l0aChcIk5ldyB3YWxsZXQgYWRkcmVzcyBjYW5ub3QgYmUgemVybyBhZGRyZXNzXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoXCJXaXRoZHJhdyBUb2tlbnNcIiwgKCkgPT4ge1xyXG4gICAgICAgIGl0KFwic2hvdWxkIGFsbG93IHRoZSBvd25lciB0byB3aXRoZHJhdyBtaXN0YWtlbmx5IHNlbnQgdG9rZW5zXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgcGF5bWVudFRva2VuLnRyYW5zZmVyKHBheW1lbnQuYWRkcmVzcywgMTAwLCB7IGZyb206IG93bmVyIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBiYWxhbmNlQmVmb3JlID0gYXdhaXQgcGF5bWVudFRva2VuLmJhbGFuY2VPZihvd25lcik7XHJcbiAgICAgICAgICAgIGF3YWl0IHBheW1lbnQud2l0aGRyYXdUb2tlbnMocGF5bWVudFRva2VuLmFkZHJlc3MsIG93bmVyLCA1MCwgeyBmcm9tOiBvd25lciB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGJhbGFuY2VBZnRlciA9IGF3YWl0IHBheW1lbnRUb2tlbi5iYWxhbmNlT2Yob3duZXIpO1xyXG4gICAgICAgICAgICBleHBlY3QoYmFsYW5jZUFmdGVyLnRvU3RyaW5nKCkpLnRvLmVxdWFsKGJhbGFuY2VCZWZvcmUuYWRkKDUwKS50b1N0cmluZygpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJzaG91bGQgcmV2ZXJ0IGlmIHRyeWluZyB0byB3aXRoZHJhdyBtb3JlIHRoYW4gdGhlIGNvbnRyYWN0IGJhbGFuY2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBwYXltZW50VG9rZW4udHJhbnNmZXIocGF5bWVudC5hZGRyZXNzLCAxMDAsIHsgZnJvbTogb3duZXIgfSk7XHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChwYXltZW50LndpdGhkcmF3VG9rZW5zKHBheW1lbnRUb2tlbi5hZGRyZXNzLCBvd25lciwgMjAwLCB7IGZyb206IG93bmVyIH0pKS50by5iZS5yZXZlcnRlZFdpdGgoXCJJbnN1ZmZpY2llbnQgdG9rZW4gYmFsYW5jZVwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoXCJzaG91bGQgbm90IGFsbG93IG5vbi1vd25lciB0byB3aXRoZHJhdyB0b2tlbnNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QocGF5bWVudC53aXRoZHJhd1Rva2VucyhwYXltZW50VG9rZW4uYWRkcmVzcywgb3duZXIsIDUwLCB7IGZyb206IGFkbWluIH0pKS50by5iZS5yZXZlcnRlZFdpdGgoXCJPd25hYmxlOiBjYWxsZXIgaXMgbm90IHRoZSBvd25lclwiKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNO0VBQUVBO0FBQU8sQ0FBQyxHQUFHQyxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQ2xDLE1BQU1DLE9BQU8sR0FBR0MsU0FBUyxDQUFDRixPQUFPLENBQUMsU0FBUyxDQUFDO0FBQzVDLE1BQU1HLGFBQWEsR0FBR0QsU0FBUyxDQUFDRixPQUFPLENBQUMsZUFBZSxDQUFDO0FBQ3hELE1BQU1JLEtBQUssR0FBR0YsU0FBUyxDQUFDRixPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQzs7QUFFMUNLLFFBQVEsQ0FBQyxTQUFTLEVBQUdDLFFBQVEsSUFBSztFQUM5QixJQUFJQyxPQUFPO0VBQ1gsSUFBSUMsWUFBWTtFQUNoQixNQUFNLENBQUNDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUVDLElBQUksQ0FBQyxHQUFHTixRQUFRO0VBRTlDTyxVQUFVLENBQUMsWUFBWTtJQUNuQjtJQUNBTCxZQUFZLEdBQUcsTUFBTUosS0FBSyxDQUFDVSxHQUFHLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUU7TUFBRUMsSUFBSSxFQUFFTjtJQUFNLENBQUMsQ0FBQzs7SUFFM0U7SUFDQSxNQUFNTyxhQUFhLEdBQUcsTUFBTWIsYUFBYSxDQUFDVyxHQUFHLENBQUMsQ0FBQztJQUMvQyxNQUFNRSxhQUFhLENBQUNDLFFBQVEsQ0FBQ1AsS0FBSyxFQUFFO01BQUVLLElBQUksRUFBRU47SUFBTSxDQUFDLENBQUM7O0lBRXBEO0lBQ0FGLE9BQU8sR0FBRyxNQUFNTixPQUFPLENBQUNhLEdBQUcsQ0FBQ04sWUFBWSxDQUFDVSxPQUFPLEVBQUUsQ0FBQyxFQUFFVCxLQUFLLENBQUMsQ0FBQyxDQUFDOztJQUU3RDtJQUNBLE1BQU1ELFlBQVksQ0FBQ1csUUFBUSxDQUFDUCxJQUFJLEVBQUUsSUFBSSxFQUFFO01BQUVHLElBQUksRUFBRU47SUFBTSxDQUFDLENBQUM7RUFDNUQsQ0FBQyxDQUFDO0VBRUZXLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxNQUFNO0lBQ2pDQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsWUFBWTtNQUN0RCxNQUFNQyxNQUFNLEdBQUcsR0FBRztNQUNsQixNQUFNZCxZQUFZLENBQUNlLE9BQU8sQ0FBQ2hCLE9BQU8sQ0FBQ1csT0FBTyxFQUFFSSxNQUFNLEVBQUU7UUFBRVAsSUFBSSxFQUFFSDtNQUFLLENBQUMsQ0FBQztNQUVuRSxNQUFNWSxpQkFBaUIsR0FBRyxNQUFNaEIsWUFBWSxDQUFDaUIsU0FBUyxDQUFDYixJQUFJLENBQUM7TUFDNUQsTUFBTWMsb0JBQW9CLEdBQUcsTUFBTWxCLFlBQVksQ0FBQ2lCLFNBQVMsQ0FBQ2QsT0FBTyxDQUFDO01BQ2xFLE1BQU1nQixxQkFBcUIsR0FBRyxNQUFNbkIsWUFBWSxDQUFDaUIsU0FBUyxDQUFDaEIsS0FBSyxDQUFDO01BRWpFLE1BQU1GLE9BQU8sQ0FBQ3FCLGNBQWMsQ0FBQ2hCLElBQUksRUFBRUQsT0FBTyxFQUFFVyxNQUFNLEVBQUU7UUFBRVAsSUFBSSxFQUFFTDtNQUFNLENBQUMsQ0FBQztNQUVwRSxNQUFNbUIsZ0JBQWdCLEdBQUcsTUFBTXJCLFlBQVksQ0FBQ2lCLFNBQVMsQ0FBQ2IsSUFBSSxDQUFDO01BQzNELE1BQU1rQixtQkFBbUIsR0FBRyxNQUFNdEIsWUFBWSxDQUFDaUIsU0FBUyxDQUFDZCxPQUFPLENBQUM7TUFDakUsTUFBTW9CLG9CQUFvQixHQUFHLE1BQU12QixZQUFZLENBQUNpQixTQUFTLENBQUNoQixLQUFLLENBQUM7TUFFaEVWLE1BQU0sQ0FBQzhCLGdCQUFnQixDQUFDRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUNDLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDVixpQkFBaUIsQ0FBQ1csR0FBRyxDQUFDYixNQUFNLENBQUMsQ0FBQ1UsUUFBUSxDQUFDLENBQUMsQ0FBQztNQUN0RmpDLE1BQU0sQ0FBQytCLG1CQUFtQixDQUFDRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUNDLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDUixvQkFBb0IsQ0FBQ1UsR0FBRyxDQUFDZCxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUNVLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO01BQ3JHakMsTUFBTSxDQUFDZ0Msb0JBQW9CLENBQUNDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsRUFBRSxDQUFDQyxLQUFLLENBQUNQLHFCQUFxQixDQUFDUyxHQUFHLENBQUNkLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQ1UsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0csQ0FBQyxDQUFDO0lBRUZYLEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxZQUFZO01BQzFELE1BQU10QixNQUFNLENBQUNRLE9BQU8sQ0FBQ3FCLGNBQWMsQ0FBQ2hCLElBQUksRUFBRUQsT0FBTyxFQUFFLENBQUMsRUFBRTtRQUFFSSxJQUFJLEVBQUVMO01BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQ3VCLEVBQUUsQ0FBQ0ksRUFBRSxDQUFDQyxZQUFZLENBQUMsMENBQTBDLENBQUM7SUFDMUksQ0FBQyxDQUFDO0lBRUZqQixFQUFFLENBQUMsdURBQXVELEVBQUUsWUFBWTtNQUNwRSxNQUFNQyxNQUFNLEdBQUcsR0FBRztNQUNsQixNQUFNdkIsTUFBTSxDQUFDUSxPQUFPLENBQUNxQixjQUFjLENBQUNoQixJQUFJLEVBQUVELE9BQU8sRUFBRVcsTUFBTSxFQUFFO1FBQUVQLElBQUksRUFBRUw7TUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDdUIsRUFBRSxDQUFDSSxFQUFFLENBQUNDLFlBQVksQ0FBQyw4QkFBOEIsQ0FBQztJQUNuSSxDQUFDLENBQUM7RUFDTixDQUFDLENBQUM7RUFFRmxCLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxNQUFNO0lBQ3RDQyxFQUFFLENBQUMsbURBQW1ELEVBQUUsWUFBWTtNQUNoRSxNQUFNZCxPQUFPLENBQUNnQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUU7UUFBRXhCLElBQUksRUFBRUw7TUFBTSxDQUFDLENBQUM7TUFDcEQsTUFBTThCLE1BQU0sR0FBRyxNQUFNakMsT0FBTyxDQUFDa0MsV0FBVyxDQUFDLENBQUM7TUFDMUMxQyxNQUFNLENBQUN5QyxNQUFNLENBQUNSLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsRUFBRSxDQUFDQyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQzVDLENBQUMsQ0FBQztJQUVGYixFQUFFLENBQUMsdURBQXVELEVBQUUsWUFBWTtNQUNwRSxNQUFNcUIsTUFBTSxHQUFHLE1BQU1uQyxPQUFPLENBQUNrQyxXQUFXLENBQUMsQ0FBQztNQUMxQyxNQUFNRSxFQUFFLEdBQUcsTUFBTXBDLE9BQU8sQ0FBQ2dDLGlCQUFpQixDQUFDLEVBQUUsRUFBRTtRQUFFeEIsSUFBSSxFQUFFTDtNQUFNLENBQUMsQ0FBQztNQUMvRCxNQUFNOEIsTUFBTSxHQUFHLE1BQU1qQyxPQUFPLENBQUNrQyxXQUFXLENBQUMsQ0FBQztNQUUxQzFDLE1BQU0sQ0FBQzRDLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUMsQ0FBQ1osRUFBRSxDQUFDQyxLQUFLLENBQUMsb0JBQW9CLENBQUM7TUFDdkRuQyxNQUFNLENBQUM0QyxFQUFFLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQ0UsSUFBSSxDQUFDSixNQUFNLENBQUNWLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsRUFBRSxDQUFDQyxLQUFLLENBQUNRLE1BQU0sQ0FBQ1YsUUFBUSxDQUFDLENBQUMsQ0FBQztNQUNyRWpDLE1BQU0sQ0FBQzRDLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDRSxJQUFJLENBQUNOLE1BQU0sQ0FBQ1IsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDQyxFQUFFLENBQUNDLEtBQUssQ0FBQyxJQUFJLENBQUM7SUFDNUQsQ0FBQyxDQUFDO0lBRUZiLEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxZQUFZO01BQ3BFLE1BQU10QixNQUFNLENBQUNRLE9BQU8sQ0FBQ2dDLGlCQUFpQixDQUFDLEVBQUUsRUFBRTtRQUFFeEIsSUFBSSxFQUFFSjtNQUFRLENBQUMsQ0FBQyxDQUFDLENBQUNzQixFQUFFLENBQUNJLEVBQUUsQ0FBQ0MsWUFBWSxDQUFDLHdDQUF3QyxDQUFDO0lBQy9ILENBQUMsQ0FBQztJQUVGakIsRUFBRSxDQUFDLCtDQUErQyxFQUFFLFlBQVk7TUFDNUQsTUFBTXRCLE1BQU0sQ0FBQ1EsT0FBTyxDQUFDZ0MsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1FBQUV4QixJQUFJLEVBQUVMO01BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQ3VCLEVBQUUsQ0FBQ0ksRUFBRSxDQUFDQyxZQUFZLENBQUMsd0JBQXdCLENBQUM7SUFDOUcsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0VBRUZsQixRQUFRLENBQUMsNEJBQTRCLEVBQUUsTUFBTTtJQUN6Q0MsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLFlBQVk7TUFDbkUsTUFBTTBCLFNBQVMsR0FBR3pDLFFBQVEsQ0FBQyxDQUFDLENBQUM7TUFDN0IsTUFBTUMsT0FBTyxDQUFDeUMsb0JBQW9CLENBQUNELFNBQVMsRUFBRTtRQUFFaEMsSUFBSSxFQUFFTDtNQUFNLENBQUMsQ0FBQztNQUM5RCxNQUFNdUMsYUFBYSxHQUFHLE1BQU0xQyxPQUFPLENBQUMyQyxjQUFjLENBQUMsQ0FBQztNQUNwRG5ELE1BQU0sQ0FBQ2tELGFBQWEsQ0FBQyxDQUFDaEIsRUFBRSxDQUFDQyxLQUFLLENBQUNhLFNBQVMsQ0FBQztJQUM3QyxDQUFDLENBQUM7SUFFRjFCLEVBQUUsQ0FBQywwREFBMEQsRUFBRSxZQUFZO01BQ3ZFLE1BQU04QixTQUFTLEdBQUcsTUFBTTVDLE9BQU8sQ0FBQzJDLGNBQWMsQ0FBQyxDQUFDO01BQ2hELE1BQU1ILFNBQVMsR0FBR3pDLFFBQVEsQ0FBQyxDQUFDLENBQUM7TUFDN0IsTUFBTXFDLEVBQUUsR0FBRyxNQUFNcEMsT0FBTyxDQUFDeUMsb0JBQW9CLENBQUNELFNBQVMsRUFBRTtRQUFFaEMsSUFBSSxFQUFFTDtNQUFNLENBQUMsQ0FBQztNQUV6RVgsTUFBTSxDQUFDNEMsRUFBRSxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUNDLEtBQUssQ0FBQyxDQUFDWixFQUFFLENBQUNDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQztNQUMxRG5DLE1BQU0sQ0FBQzRDLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDRSxJQUFJLENBQUNLLFNBQVMsQ0FBQyxDQUFDbEIsRUFBRSxDQUFDQyxLQUFLLENBQUNpQixTQUFTLENBQUM7TUFDckRwRCxNQUFNLENBQUM0QyxFQUFFLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQ0UsSUFBSSxDQUFDQyxTQUFTLENBQUMsQ0FBQ2QsRUFBRSxDQUFDQyxLQUFLLENBQUNhLFNBQVMsQ0FBQztJQUN6RCxDQUFDLENBQUM7SUFFRjFCLEVBQUUsQ0FBQywwREFBMEQsRUFBRSxZQUFZO01BQ3ZFLE1BQU10QixNQUFNLENBQUNRLE9BQU8sQ0FBQ3lDLG9CQUFvQixDQUFDMUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQUVTLElBQUksRUFBRUo7TUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDc0IsRUFBRSxDQUFDSSxFQUFFLENBQUNDLFlBQVksQ0FBQyx3Q0FBd0MsQ0FBQztJQUMzSSxDQUFDLENBQUM7SUFFRmpCLEVBQUUsQ0FBQyxrRUFBa0UsRUFBRSxZQUFZO01BQy9FLE1BQU10QixNQUFNLENBQUNRLE9BQU8sQ0FBQ3lDLG9CQUFvQixDQUFDLDRDQUE0QyxFQUFFO1FBQUVqQyxJQUFJLEVBQUVMO01BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQ3VCLEVBQUUsQ0FBQ0ksRUFBRSxDQUFDQyxZQUFZLENBQUMsMkNBQTJDLENBQUM7SUFDN0ssQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0VBRUZsQixRQUFRLENBQUMsaUJBQWlCLEVBQUUsTUFBTTtJQUM5QkMsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLFlBQVk7TUFDeEUsTUFBTWIsWUFBWSxDQUFDVyxRQUFRLENBQUNaLE9BQU8sQ0FBQ1csT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUFFSCxJQUFJLEVBQUVOO01BQU0sQ0FBQyxDQUFDO01BQ2xFLE1BQU0yQyxhQUFhLEdBQUcsTUFBTTVDLFlBQVksQ0FBQ2lCLFNBQVMsQ0FBQ2hCLEtBQUssQ0FBQztNQUN6RCxNQUFNRixPQUFPLENBQUM4QyxjQUFjLENBQUM3QyxZQUFZLENBQUNVLE9BQU8sRUFBRVQsS0FBSyxFQUFFLEVBQUUsRUFBRTtRQUFFTSxJQUFJLEVBQUVOO01BQU0sQ0FBQyxDQUFDO01BRTlFLE1BQU02QyxZQUFZLEdBQUcsTUFBTTlDLFlBQVksQ0FBQ2lCLFNBQVMsQ0FBQ2hCLEtBQUssQ0FBQztNQUN4RFYsTUFBTSxDQUFDdUQsWUFBWSxDQUFDdEIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDQyxFQUFFLENBQUNDLEtBQUssQ0FBQ2tCLGFBQWEsQ0FBQ2hCLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQ0osUUFBUSxDQUFDLENBQUMsQ0FBQztJQUM5RSxDQUFDLENBQUM7SUFFRlgsRUFBRSxDQUFDLG9FQUFvRSxFQUFFLFlBQVk7TUFDakYsTUFBTWIsWUFBWSxDQUFDVyxRQUFRLENBQUNaLE9BQU8sQ0FBQ1csT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUFFSCxJQUFJLEVBQUVOO01BQU0sQ0FBQyxDQUFDO01BQ2xFLE1BQU1WLE1BQU0sQ0FBQ1EsT0FBTyxDQUFDOEMsY0FBYyxDQUFDN0MsWUFBWSxDQUFDVSxPQUFPLEVBQUVULEtBQUssRUFBRSxHQUFHLEVBQUU7UUFBRU0sSUFBSSxFQUFFTjtNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUN3QixFQUFFLENBQUNJLEVBQUUsQ0FBQ0MsWUFBWSxDQUFDLDRCQUE0QixDQUFDO0lBQzVJLENBQUMsQ0FBQztJQUVGakIsRUFBRSxDQUFDLCtDQUErQyxFQUFFLFlBQVk7TUFDNUQsTUFBTXRCLE1BQU0sQ0FBQ1EsT0FBTyxDQUFDOEMsY0FBYyxDQUFDN0MsWUFBWSxDQUFDVSxPQUFPLEVBQUVULEtBQUssRUFBRSxFQUFFLEVBQUU7UUFBRU0sSUFBSSxFQUFFTDtNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUN1QixFQUFFLENBQUNJLEVBQUUsQ0FBQ0MsWUFBWSxDQUFDLGtDQUFrQyxDQUFDO0lBQ2pKLENBQUMsQ0FBQztFQUNOLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["expect","require","Payment","artifacts","AccessControl","ERC20","contract","accounts","payment","paymentToken","owner","admin","creator","user","beforeEach","new","from","accessControl","addAdmin","address","transfer","describe","it","amount","approve","userBalanceBefore","balanceOf","creatorBalanceBefore","platformBalanceBefore","processPayment","userBalanceAfter","creatorBalanceAfter","platformBalanceAfter","toString","to","equal","sub","add","be","revertedWith","updatePlatformFee","newFee","platformFee","oldFee","tx","logs","event","args","newWallet","updatePlatformWallet","updatedWallet","platformWallet","oldWallet","balanceBefore","withdrawTokens","balanceAfter"],"sourceRoot":"A:\\Blockchainformedia\\test\\","sources":["Payment.test.js"],"sourcesContent":["const { expect } = require(\"chai\");\r\nconst Payment = artifacts.require(\"Payment\");\r\nconst AccessControl = artifacts.require(\"AccessControl\");\r\nconst ERC20 = artifacts.require(\"ERC20\"); // Assuming you have an ERC20 token contract for testing\r\n\r\ncontract(\"Payment\", (accounts) => {\r\n    let payment;\r\n    let paymentToken;\r\n    const [owner, admin, creator, user] = accounts;\r\n\r\n    beforeEach(async () => {\r\n        // Deploy an ERC20 token for payment\r\n        paymentToken = await ERC20.new(\"TestToken\", \"TT\", 1000000, { from: owner });\r\n\r\n        // Deploy the AccessControl contract\r\n        const accessControl = await AccessControl.new();\r\n        await accessControl.addAdmin(admin, { from: owner });\r\n\r\n        // Deploy the Payment contract\r\n        payment = await Payment.new(paymentToken.address, 5, owner); // 5% platform fee\r\n\r\n        // Mint some tokens to the user for testing\r\n        await paymentToken.transfer(user, 1000, { from: owner });\r\n    });\r\n\r\n    describe(\"Payment Processing\", () => {\r\n        it(\"should allow users to process a payment\", async () => {\r\n            const amount = 100;\r\n            await paymentToken.approve(payment.address, amount, { from: user });\r\n\r\n            const userBalanceBefore = await paymentToken.balanceOf(user);\r\n            const creatorBalanceBefore = await paymentToken.balanceOf(creator);\r\n            const platformBalanceBefore = await paymentToken.balanceOf(owner);\r\n\r\n            await payment.processPayment(user, creator, amount, { from: admin });\r\n\r\n            const userBalanceAfter = await paymentToken.balanceOf(user);\r\n            const creatorBalanceAfter = await paymentToken.balanceOf(creator);\r\n            const platformBalanceAfter = await paymentToken.balanceOf(owner);\r\n\r\n            expect(userBalanceAfter.toString()).to.equal(userBalanceBefore.sub(amount).toString());\r\n            expect(creatorBalanceAfter.toString()).to.equal(creatorBalanceBefore.add(amount * 0.95).toString()); // 95% to creator\r\n            expect(platformBalanceAfter.toString()).to.equal(platformBalanceBefore.add(amount * 0.05).toString()); // 5% to platform\r\n        });\r\n\r\n        it(\"should revert if the payment amount is zero\", async () => {\r\n            await expect(payment.processPayment(user, creator, 0, { from: admin })).to.be.revertedWith(\"Payment amount must be greater than zero\");\r\n        });\r\n\r\n        it(\"should revert if the buyer has insufficient allowance\", async () => {\r\n            const amount = 100;\r\n            await expect(payment.processPayment(user, creator, amount, { from: admin })).to.be.revertedWith(\"Platform fee transfer failed\");\r\n        });\r\n    });\r\n\r\n    describe(\"Platform Fee Management\", () => {\r\n        it(\"should allow the admin to update the platform fee\", async () => {\r\n            await payment.updatePlatformFee(10, { from: admin });\r\n            const newFee = await payment.platformFee();\r\n            expect(newFee.toString()).to.equal(\"10\");\r\n        });\r\n\r\n        it(\"should emit an event when the platform fee is updated\", async () => {\r\n            const oldFee = await payment.platformFee();\r\n            const tx = await payment.updatePlatformFee(10, { from: admin });\r\n            const newFee = await payment.platformFee();\r\n\r\n            expect(tx.logs[0].event).to.equal(\"PlatformFeeUpdated\");\r\n            expect(tx.logs[0].args.oldFee.toString()).to.equal(oldFee.toString());\r\n            expect(tx.logs[0].args.newFee.toString()).to.equal(\"10\");\r\n        });\r\n\r\n        it(\"should not allow non-admin to update the platform fee\", async () => {\r\n            await expect(payment.updatePlatformFee(10, { from: creator })).to.be.revertedWith(\"Only the admin can perform this action\");\r\n        });\r\n\r\n        it(\"should not allow invalid platform fee updates\", async () => {\r\n            await expect(payment.updatePlatformFee(101, { from: admin })).to.be.revertedWith(\"Invalid fee percentage\");\r\n        });\r\n    });\r\n\r\n    describe(\"Platform Wallet Management\", () => {\r\n        it(\"should allow the admin to update the platform wallet\", async () => {\r\n            const newWallet = accounts[2];\r\n            await payment.updatePlatformWallet(newWallet, { from: admin });\r\n            const updatedWallet = await payment.platformWallet();\r\n            expect(updatedWallet).to.equal(newWallet);\r\n        });\r\n\r\n        it(\"should emit an event when the platform wallet is updated\", async () => {\r\n            const oldWallet = await payment.platformWallet();\r\n            const newWallet = accounts[2];\r\n            const tx = await payment.updatePlatformWallet(newWallet, { from: admin });\r\n\r\n            expect(tx.logs[0].event).to.equal(\"PlatformWalletUpdated\");\r\n            expect(tx.logs[0].args.oldWallet).to.equal(oldWallet);\r\n            expect(tx.logs[0].args.newWallet).to.equal(newWallet);\r\n        });\r\n\r\n        it(\"should not allow non-admin to update the platform wallet\", async () => {\r\n            await expect(payment.updatePlatformWallet(accounts[2], { from: creator })).to.be.revertedWith(\"Only the admin can perform this action\");\r\n        });\r\n\r\n        it(\"should not allow setting the platform wallet to the zero address\", async () => {\r\n            await expect(payment.updatePlatformWallet(\"0x0000000000000000000000000000000000000000\", { from: admin })).to.be.revertedWith(\"New wallet address cannot be zero address\");\r\n        });\r\n    });\r\n\r\n    describe(\"Withdraw Tokens\", () => {\r\n        it(\"should allow the owner to withdraw mistakenly sent tokens\", async () => {\r\n            await paymentToken.transfer(payment.address, 100, { from: owner });\r\n            const balanceBefore = await paymentToken.balanceOf(owner);\r\n            await payment.withdrawTokens(paymentToken.address, owner, 50, { from: owner });\r\n\r\n            const balanceAfter = await paymentToken.balanceOf(owner);\r\n            expect(balanceAfter.toString()).to.equal(balanceBefore.add(50).toString());\r\n        });\r\n\r\n        it(\"should revert if trying to withdraw more than the contract balance\", async () => {\r\n            await paymentToken.transfer(payment.address, 100, { from: owner });\r\n            await expect(payment.withdrawTokens(paymentToken.address, owner, 200, { from: owner })).to.be.revertedWith(\"Insufficient token balance\");\r\n        });\r\n\r\n        it(\"should not allow non-owner to withdraw tokens\", async () => {\r\n            await expect(payment.withdrawTokens(paymentToken.address, owner, 50, { from: admin })).to.be.revertedWith(\"Ownable: caller is not the owner\");\r\n        });\r\n    });\r\n});\r\n"],"mappings":"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","ignoreList":[]}},"mtime":1727713286174}}